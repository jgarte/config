; detect OS
(defvar run-unix
  (or (equal system-type 'gnu/linux)
      (or (equal system-type 'usg-unix-v)
          (or  (equal system-type 'berkeley-unix)
               (equal system-type 'cygwin)))))

(defvar run-linux
  (equal system-type 'gnu/linux))
(defvar run-system-v
  (equal system-type 'usg-unix-v))
(defvar run-bsd
  (equal system-type 'berkeley-unix))
(defvar run-cygwin
  (equal system-type 'cygwin))

(defvar run-w32
  (and (null run-unix)
       (or (equal system-type 'windows-nt)
           (equal system-type 'ms-dos))))

(defvar run-darwin (equal system-type 'darwin))

;; eval-safe
;; http://www.sodan.org/~knagano/emacs/dotemacs.html#eval-safe
(defmacro eval-safe (&rest body)
  `(condition-case err
       (progn ,@body)
     (error (message "[eval-safe] %s" err))))

(eval-when-compile
  (require 'cl))

; req
(require 'flymake)
(require 'smart-compile)

; InteractivelyDoThings
; ref. http://www.emacswiki.org/emacs/InteractivelyDoThings
;; C-d to enter dired.
;; C-l to run ido-reread-directory to refresh the current work directory.
;; C-f to return to normal find-file
(require 'ido)
(ido-mode t)
(setq ido-enable-flex-matching t)
(add-hook 'ido-setup-hook
          (lambda ()
            (define-key ido-completion-map [tab] 'ido-complete)))

; using ido programmatically
(defun my-icompleting-read(prompt choices)
  (let ((ido-make-buffer-list-hook
         (lambda ()
           (setq ido-temp-list choices))))
    (ido-read-buffer prompt)))

; ack
(custom-set-variables '(grep-program "ack -H -a --nogroup"))

; smart-compile
(defvar smart-compile-alist '(
  ("\\.c\\'"          . "gcc %f -lm -o %n")
  ("\\.[Cc]+[Pp]*\\'" . "g++ %f -lm -o %n")
  ("\\.java\\'"       . "javac %f")
  ("\\.f90\\'"        . "f90 %f -o %n")
  ("\\.[Ff]\\'"       . "f77 %f -o %n")
  ("\\.tex\\'"        . (tex-file))
  ("\\.pl\\'"         . "perl -cw %f")
  (emacs-lisp-mode    . (emacs-lisp-byte-compile))
) "...")

(global-set-key "\C-cc" 'smart-compile)

;; ;; set global
;; ;(load "term/bobcat")
(global-set-key [delete] 'delete-char)
(global-set-key [backspace] 'delete-backward-char)
(global-set-key "\C-h" 'delete-backward-char)
(global-set-key "\C-o" 'next-multiframe-window)

;; no tab
(setq-default indent-tabs-mode nil)

;; colored space
(defface my-face-b-1 '((t (:background "medium aquamarine"))) nil)
(defface my-face-b-1 '((t (:background "dark turquoise"))) nil)
(defface my-face-b-2 '((t (:background "cyan"))) nil)
(defface my-face-b-2 '((t (:background "SeaGreen"))) nil)
(defface my-face-u-1 '((t (:foreground "SteelBlue" :underline t))) nil)
(defvar my-face-b-1 'my-face-b-1)
(defvar my-face-b-2 'my-face-b-2)
(defvar my-face-u-1 'my-face-u-1)
(defadvice font-lock-mode (before my-font-lock-mode ())
    (font-lock-add-keywords
        major-mode
            '(
                ("ã€€" 0 my-face-b-1 append)
                ("\t" 0 my-face-b-2 append)
                ("[ ]+$" 0 my-face-u-1 append)
    )))
(ad-enable-advice 'font-lock-mode 'before 'my-font-lock-mode)
(ad-activate 'font-lock-mode)
(add-hook 'find-file-hooks '(lambda ()
    (if font-lock-mode
        nil
    (font-lock-mode t))))

;; no bar
(tool-bar-mode nil)
(menu-bar-mode nil)
(set-scroll-bar-mode nil)

;; no bell
;; (setq visible-bell t)
(setq ring-bell-function 'ignore)

;; show paren, line, column
(show-paren-mode 1)
(line-number-mode t)
(column-number-mode t)

;; display time
(setq display-time-day-and-date t)
(setq display-time-24hr-format t)
(display-time)

; for programming
(defun electric-pair ()
  "Insert character pair without surronding spaces"
  (interactive)
  (let (parens-require-spaces)
    (insert-pair)))

; backup
;; (setq make-backup-files t)
;; (setq backup-directory "~/.bak")
;; (if (and (boundp 'backup-directory)
;;          (not (fboundp 'make-backup-file-name-original)))
;;     (progn
;;       (fset 'make-backup-file-name-original
;;             (symbol-function 'make-backup-file-name))
;;       (defun make-backup-file-name (filename)
;;         (if (file-directory-p (expand-file-name backup-directory))
;;             (concat (expand-file-name backup-directory) 
;;                     "/" (file-name-nondirectory filename))
;;           (make-backup-file-name-original filename)))))
